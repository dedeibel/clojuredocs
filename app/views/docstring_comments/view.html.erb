<% content_for :title, " - Docstring Discussion - #{@function.namespace.name}/#{@function.name}" %>

<script type"text/javascript">
  $(document).ready(function() {
    CD.DocstringDiscussion.init({
  userId: <%= current_user.id rescue nil %>,
  functionId: <%= @function.id %>,
  editContent: '<%= (current_user_session ? (render (:partial => 'editable_docstring_comment_item', :locals => {:user => current_user})).gsub("\n", "") : "") %>'
    })
  })
  
</script>
<div class="docstring_discussion">
  <div class="container_16">
    <div class="grid_12 prefix_2 suffix_2">
      <%= link_to "<< back to #{@function.namespace.name}/#{@function.name}", @function.link_opts %>
      <h2>Docstring discussion for version <span class="highlight"><%= @function.library.version %></span> of <%= @function.namespace.name %>/<%= @function.name %>.</h2>
      <% if @function.doc %>
        <div class="doc">
          <a class="internal_nav scroll" href="#doc" name="doc"></a>
          <div class="content"><%= @function.doc.gsub("\n", "<br />").gsub(/http:\/\/[a-zA-Z0-9-.\/?%&=:@;_#]*/){|s| '<a href="' + s + '">' + s + '</a>' } if @function.doc %><br />
          </div>
          <div class="copyright_license">
            <%= @function.library.copyright %>

            <%= (@function.library.license || "See <a href='#{@function.library.site_url}'>#{@function.library.site_url}</a> for copyright and license details.")%>
          </div>
        </div>
      <% else %>
        <div class="doc">
          <div class="content empty_docstring">
            No docstring for <%= @function.namespace.name %>/<%= @function.name %>.
          </div>
        </div>
      <% end %>
      <div class="docstring_comments">
        <!-- <div class="keep_me_updated"> -->
        <!--   <input name="keep_me_updated" type="checkbox"> -->
        <!--   <label for="keep_me_updated"> -->
        <!--     Notify me of updates to this conversation. -->
        <!--   </label> -->
        <!--   <div style="font-size: 11px">We'll send you a short email when somebody adds or edits a comment on this var's docstring.</div> -->
        <!-- </div> -->

        <ul class="docstring_comments_list">
          <% @function.docstring_comments.each do |dc| %>
            <%= render :partial => 'docstring_comment_item', :locals => {:dc => dc} %>
	  <% end %>
        </ul>
        <% if current_user_session %>
        <div class="notify_me">
          <input type="checkbox" name="send_updates"/> Send me an email when somebody adds or updates a comment.
        </div>
        <% end %>

        <div class="edit_comment">
          <h3>What&apos;s your suggestion?</h3>
          <ul>
            <li>Be specific about <em>why</em> you feel the docstring for this var needs work. Is it confusing? Is it wrong? Why?</li>
            <li>Suggestions and comments only, please. Take a look at Clojure's <a href="http://clojure.org/contributing">contributing overview</a> if you'd like to submit patches directly.</li>
          </ul>
          <% if current_user_session %>
            <%= render :partial => 'editable_docstring_comment_item', :locals => {:user => current_user} %>
          <% else %>
            <br />
            <h4>Log in to leave a comment.</h4>
          <% end %>
        </div>
      </div>
    </div>
  </div>
